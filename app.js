!function(){"use strict";var t,e=150;function n(e){switch(e){case t.Up:return t.Down;case t.Down:return t.Up;case t.Left:return t.Right;case t.Right:return t.Left}}function i(t,e,i,r){return r===t&&i===e||r===n(e)&&i===n(t)}function r(e,n){if(!n)return"tail_"+e.toString();if(e===n)return e===t.Up||e===t.Down?"body_vertical":"body_horizontal";if(i(t.Up,t.Right,e,n))return"body_corner_up_right";if(i(t.Up,t.Left,e,n))return"body_corner_up_left";if(i(t.Down,t.Right,e,n))return"body_corner_down_right";if(i(t.Down,t.Left,e,n))return"body_corner_down_left";throw new Error("Invalid directions: "+e+", "+n)}function o(t){var e=document.getElementById(t);if(!e)throw new Error("Element #"+t+" does not exist");return e}!function(t){t.Up="up",t.Down="down",t.Left="left",t.Right="right"}(t||(t={}));var a,s,h,u,c,f,d={create:function(){console.log("Loading state created!")},render:function(t){console.log("Loading...")}},p=function(){function e(t,e){this.x=t,this.y=e}return e.random=function(){return new e(Math.floor(24*Math.random()),Math.floor(16*Math.random()))},e.prototype.equals=function(t){return this.x===t.x&&this.y===t.y},e.prototype.translate=function(n){var i=this.x,r=this.y;return n===t.Up?r--:n===t.Down?r++:n===t.Left?i--:n===t.Right&&i++,i<0&&(i=23),i>=24&&(i=0),r<0&&(r=15),r>=16&&(r=0),new e(i,r)},e.prototype.add=function(t){return new e(this.x+t.x,this.y+t.y)},e.prototype.toScreen=function(){return{x:16*this.x,y:16*this.y}},e}(),l=function(){function t(t,e,n){this.position=t,this.direction=e,this.updateSprite(n)}return t.prototype.updateSprite=function(t){this.sheetTile=t?r(this.direction,t.direction):r(this.direction)},t.prototype.render=function(t,e){e.drawTile(t,this.sheetTile,this.position)},t}(),w=function(){function t(){this.time=e,this.resetValue=e}return t.prototype.isTick=function(t){return this.time-=t,this.time<0&&(this.time+=Math.round(this.resetValue),!0)},t.prototype.reset=function(){this.time=Math.round(this.resetValue)},t.prototype.increaseGameSpeed=function(){this.resetValue*=.9},t}(),_=function(){function t(t,e){this.tiles=new Map,this.sheet=t,e&&e(this.identify.bind(this))}return t.prototype.identify=function(t,e,n){this.tiles.set(t,{x:e,y:n})},t.prototype.drawTile=function(t,e,n){var i={x:0,y:0};if("string"==typeof e){var r=this.tiles.get(e);if(!r)throw new Error("Could not find sprite "+e+" on sheet");i=r}else i.x=e;t.layer.drawImage(this.sheet,16*i.x,16*i.y,16,16,16*n.x,16*n.y,16,16)},t.snek=function(e){return new t(e.images.snek,function(t){t("head_up",0,0),t("head_right",0,1),t("head_down",0,2),t("head_left",0,3),t("head_open_up",1,0),t("head_open_right",1,1),t("head_open_down",1,2),t("head_open_left",1,3),t("body_vertical",2,0),t("body_horizontal",2,1),t("body_corner_up_right",3,0),t("body_corner_up_left",4,0),t("body_corner_down_right",3,1),t("body_corner_down_left",4,1),t("tail_down",2,2),t("tail_up",2,3),t("tail_right",3,2),t("tail_left",4,2)})},t}(),y=0,g=0,m="",v=[],b=new w,x=!1,k=0;function L(t){return!!s.equals(t)||v.some(function(e){return e.position.equals(t)})}function R(){f=s.translate(h),x=f.equals(a)||L(f);var t=v[v.length-1].direction;m="head"+(x?"_open":"")+"_"+t.toString()}function D(){for(;;){var t=p.random();if(!L(t)){a=t,y=0;break}}}function S(t){h=t,R()}function U(){if(!L(f)){var t;f.equals(a)?(void 0===t&&(t=1),k+=t,o("score").innerText=k.toFixed(0),D(),b.increaseGameSpeed()):v.shift(),v.push(new l(s,h)),s=f,S(h);for(var e=void 0,n=0,i=v;n<i.length;n++){var r=i[n];r.updateSprite(e),e=r}R()}}var M={enter:function(){b.reset(),u=_.snek(this.app),c=new _(this.app.images.food);var e=Math.floor(8),n=Math.floor(8);s=new p(e,n),h=t.Right,v.unshift(new l(new p(e-1,n),t.Right)),v.unshift(new l(new p(e-2,n),t.Right)),f=new p(e+1,n),D(),R()},step:function(t){t*=1e3,y<3&&(g-=t)<0&&(y++,g+=150),b.isTick(t)&&U()},render:function(t){this.app.layer.clear("#ffffb5");for(var e=0,n=v;e<n.length;e++){n[e].render(this.app,u)}u.drawTile(this.app,m,s),c.drawTile(this.app,y,a)},keydown:function(e){switch(e.key){case"up":case"z":case"w":S(t.Up);break;case"down":case"s":S(t.Down);break;case"left":case"a":case"q":S(t.Left);break;case"right":case"d":S(t.Right)}}};PLAYGROUND.LoadingScreen=d,new PLAYGROUND.Application({width:384,height:256,scale:1,smoothing:!1,container:o("canvas-container"),create:function(){this.loadImage("snek"),this.loadImage("food")},ready:function(){this.setState(M),o("loading").remove(),o("frame").style.display="block"}})}();
//# sourceMappingURL=app.js.map
